# AIã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ - è¨­è¨ˆæ›¸

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [æ©Ÿèƒ½è¦ä»¶](#æ©Ÿèƒ½è¦ä»¶)
3. [éæ©Ÿèƒ½è¦ä»¶](#éæ©Ÿèƒ½è¦ä»¶)
4. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
5. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
6. [3ãƒ¢ãƒ¼ãƒ‰è¨­è¨ˆ](#3ãƒ¢ãƒ¼ãƒ‰è¨­è¨ˆ)
7. [APIä»•æ§˜](#apiä»•æ§˜)
8. [ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«](#ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«)
9. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)
10. [ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥](#ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥)

---

## æ¦‚è¦

### ç›®çš„
ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆæ¥­å‹™ã®è‡ªå‹•åŒ–ã‚’å®Ÿç¾ã™ã‚‹AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã®ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚
å–¶æ¥­æ´»å‹•ã«ãŠã„ã¦ã€å®Ÿéš›ã«å‹•ããƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’æç¤ºã™ã‚‹ã“ã¨ã§æŠ€è¡“åŠ›ã‚’è¨¼æ˜ã™ã‚‹ã€‚

### ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
- ä¸­å°ä¼æ¥­ï¼ˆã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆæ¥­å‹™ãŒã‚ã‚‹å…¨ä¼æ¥­ï¼‰
- ECã‚µã‚¤ãƒˆé‹å–¶ä¼æ¥­
- SaaSä¼æ¥­
- BtoBä¼æ¥­

### ä¾¡å€¤ææ¡ˆ
- ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆæ™‚é–“ã‚’80%å‰Šæ¸›
- å¹´é–“200ä¸‡å††ã®ã‚³ã‚¹ãƒˆå‰Šæ¸›
- 24æ™‚é–“365æ—¥å¯¾å¿œ
- ãƒ’ãƒ¥ãƒ¼ãƒãƒ³ã‚¨ãƒ©ãƒ¼ã‚¼ãƒ­

---

## æ©Ÿèƒ½è¦ä»¶

### å¿…é ˆæ©Ÿèƒ½ï¼ˆMVPï¼‰

#### 1. ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›
- AIãŒè‡ªç„¶ãªæ—¥æœ¬èªã§å¿œç­”
- ä¼šè©±å±¥æ­´ã®è¡¨ç¤º
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¿œç­”ï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œï¼‰

#### 2. FAQå¯¾å¿œ
- ã‚ˆãã‚ã‚‹è³ªå•ã¸ã®è‡ªå‹•å¿œç­”
- å–¶æ¥­æ™‚é–“ã€è¿”å“æ–¹æ³•ã€é€æ–™ãªã©ã®åŸºæœ¬æƒ…å ±
- ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®è³ªå•å¯¾å¿œ

#### 3. 3ã¤ã®ãƒ¢ãƒ¼ãƒ‰
- **Mockãƒ¢ãƒ¼ãƒ‰**: APIèª²é‡‘ãªã—ã€ãƒ‡ãƒ¢ç”¨ã®äº‹å‰å®šç¾©å¿œç­”
- **Demoãƒ¢ãƒ¼ãƒ‰**: æœ¬ç‰©ã®AIã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿è­·ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™
- **Productionãƒ¢ãƒ¼ãƒ‰**: å®Œå…¨ãªèªè¨¼ã€é¡§å®¢ç”¨

#### 4. èªè¨¼æ©Ÿèƒ½ï¼ˆDemoãƒ¢ãƒ¼ãƒ‰ï¼‰
- ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼
- Cookie/LocalStorageã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®ã¿ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›

#### 5. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆDemoãƒ¢ãƒ¼ãƒ‰ï¼‰
- 1æ—¥50å›ã¾ã§ã®åˆ©ç”¨åˆ¶é™
- IPã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ™ãƒ¼ã‚¹ã¾ãŸã¯Cookieãƒ™ãƒ¼ã‚¹
- åˆ¶é™è¶…éæ™‚ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ï¼ˆå°†æ¥æ‹¡å¼µï¼‰
- ä¼šè©±å±¥æ­´ã®ä¿å­˜
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦è©•ä¾¡
- ç®¡ç†ç”»é¢ï¼ˆFAQç·¨é›†ã€çµ±è¨ˆè¡¨ç¤ºï¼‰
- å¤šè¨€èªå¯¾å¿œ
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆç”»åƒã«ã‚ˆã‚‹å•ã„åˆã‚ã›ï¼‰

---

## éæ©Ÿèƒ½è¦ä»¶

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- åˆå›ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 2ç§’ä»¥å†…
- ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 100msä»¥å†…ã«é–‹å§‹
- ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿: 1ç§’ä»¥å†…ï¼ˆLighthouse 90ç‚¹ä»¥ä¸Šï¼‰

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- API Keyã®ç’°å¢ƒå¤‰æ•°ç®¡ç†ï¼ˆçµ¶å¯¾ã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ï¼‰
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«ã‚ˆã‚‹ã‚³ã‚¹ãƒˆç®¡ç†
- XSSå¯¾ç­–ï¼ˆå…¥åŠ›ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼‰
- CSRFå¯¾ç­–ï¼ˆNext.jsã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ©Ÿèƒ½ï¼‰

### ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£
- Vercelã®ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
- Serverless Functionsï¼ˆAPI Routesï¼‰
- ã‚¨ãƒƒã‚¸ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°

### å¯ç”¨æ€§
- Vercel 99.99% SLA
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆAPIã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰

### ä¿å®ˆæ€§
- TypeScriptå³æ ¼ãƒ¢ãƒ¼ãƒ‰
- ESLint + Prettier
- ã‚³ãƒ¡ãƒ³ãƒˆã¯æ—¥æœ¬èª
- è¨­è¨ˆæ›¸ã®å……å®Ÿ

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **Framework**: Next.js 15 (App Router)
- **Language**: TypeScript 5.x
- **Styling**: Tailwind CSS 3.x
- **UI Components**: shadcn/ui
- **State Management**: React Hooks (useState, useContext)
- **Form Handling**: React Hook Form + Zod

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **Runtime**: Next.js API Routes (Serverless Functions)
- **AI**: OpenAI GPT-4o
- **KV Store**: Vercel KV (Redisäº’æ›) - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ç”¨

### ã‚¤ãƒ³ãƒ•ãƒ©
- **Hosting**: Vercel
- **DNS**: Vercelæä¾›ãƒ‰ãƒ¡ã‚¤ãƒ³
- **Analytics**: Vercel Analytics

### é–‹ç™ºãƒ„ãƒ¼ãƒ«
- **Package Manager**: pnpm
- **Linter**: ESLint
- **Formatter**: Prettier
- **Pre-commit**: Husky + lint-staged
- **Task Runner**: Makefile

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Vercel Edge                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   Browser    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Next.js App â”‚                â”‚
â”‚  â”‚  (Client)    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  (SSR/SSG)   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                 â”‚                           â”‚
â”‚                                 â”‚                           â”‚
â”‚                                 â–¼                           â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                      â”‚  Middleware      â”‚                  â”‚
â”‚                      â”‚  - èªè¨¼ãƒã‚§ãƒƒã‚¯   â”‚                  â”‚
â”‚                      â”‚  - ãƒ¢ãƒ¼ãƒ‰åˆ¤å®š     â”‚                  â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                 â”‚                           â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                    â”‚            â”‚            â”‚            â”‚
â”‚                    â–¼            â–¼            â–¼            â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚           â”‚ Page     â”‚  â”‚ API      â”‚  â”‚ Auth     â”‚      â”‚
â”‚           â”‚ Routes   â”‚  â”‚ Routes   â”‚  â”‚ API      â”‚      â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                              â”‚                            â”‚
â”‚                              â”‚                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                    â”‚         â”‚         â”‚                â”‚
â”‚                    â–¼         â–¼         â–¼                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚              â”‚ Mock AI â”‚ â”‚ OpenAI  â”‚ â”‚ Vercel  â”‚       â”‚
â”‚              â”‚ Client  â”‚ â”‚ API     â”‚ â”‚ KV      â”‚       â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

#### 1. Mockãƒ¢ãƒ¼ãƒ‰
```
User Input
  â†“
ãƒãƒ£ãƒƒãƒˆç”»é¢ (app/page.tsx)
  â†“
API Route (app/api/chat/route.ts)
  â†“
ãƒ¢ãƒ¼ãƒ‰åˆ¤å®š (DEMO_MODE === 'mock')
  â†“
Mock AI Client (lib/mock-responses.ts)
  â†“
äº‹å‰å®šç¾©ã®å¿œç­”ã‚’è¿”ã™
  â†“
ãƒãƒ£ãƒƒãƒˆç”»é¢ã«è¡¨ç¤º
```

#### 2. Demoãƒ¢ãƒ¼ãƒ‰
```
User Input
  â†“
Middleware (middleware.ts) â†’ èªè¨¼ãƒã‚§ãƒƒã‚¯
  â†“
ãƒãƒ£ãƒƒãƒˆç”»é¢ (app/page.tsx)
  â†“
API Route (app/api/chat/route.ts)
  â†“
ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯ (lib/rate-limiter.ts) â†’ Vercel KV
  â†“
ãƒ¢ãƒ¼ãƒ‰åˆ¤å®š (DEMO_MODE === 'demo')
  â†“
OpenAI API Client (lib/openai.ts)
  â†“
OpenAI GPT-4o ã«é€ä¿¡
  â†“
ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹
  â†“
ãƒãƒ£ãƒƒãƒˆç”»é¢ã«é€æ¬¡è¡¨ç¤º
```

---

## 3ãƒ¢ãƒ¼ãƒ‰è¨­è¨ˆ

### Mode 1: Mockï¼ˆå–¶æ¥­åˆæœŸæ®µéšï¼‰

**ç›®çš„**: èª°ã§ã‚‚è§¦ã‚Œã‚‹ãƒ‡ãƒ¢ã€APIèª²é‡‘ãƒªã‚¹ã‚¯ã‚¼ãƒ­

**ç‰¹å¾´**:
- âœ… èªè¨¼ãªã—
- âœ… ãƒ¢ãƒƒã‚¯AIï¼ˆäº‹å‰å®šç¾©ã®å¿œç­”ï¼‰
- âœ… ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãªã—
- âœ… APIèª²é‡‘ã‚¼ãƒ­

**ç’°å¢ƒå¤‰æ•°**:
```env
DEMO_MODE=mock
```

**å®Ÿè£…**:
```typescript
// lib/ai-client.ts
export async function getChatResponse(message: string): Promise<string> {
  if (process.env.DEMO_MODE === 'mock') {
    // ãƒ¢ãƒƒã‚¯å¿œç­”ã‚’è¿”ã™
    return getMockResponse(message);
  }
  // ...
}

// lib/mock-responses.ts
const MOCK_RESPONSES: Record<string, string> = {
  å–¶æ¥­æ™‚é–“: 'å¹³æ—¥9:00-18:00ã€åœŸæ—¥ç¥æ—¥ã¯ä¼‘æ¥­ã§ã™',
  è¿”å“: 'è³¼å…¥å¾Œ30æ—¥ä»¥å†…ã§ã‚ã‚Œã°è¿”å“å¯èƒ½ã§ã™',
  é€æ–™: 'å…¨å›½ä¸€å¾‹550å††ã€5,000å††ä»¥ä¸Šã§é€æ–™ç„¡æ–™ã§ã™',
};

export function getMockResponse(message: string): string {
  // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°
  for (const [keyword, response] of Object.entries(MOCK_RESPONSES)) {
    if (message.includes(keyword)) {
      return response;
    }
  }
  return 'ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚æ‹…å½“è€…ãŒç¢ºèªã„ãŸã—ã¾ã™';
}
```

**Vercelãƒ‡ãƒ—ãƒ­ã‚¤**:
- Previewç’°å¢ƒã«è¨­å®š
- URL: `https://ai-chatbot-git-main-tatsuro-tokume.vercel.app`

---

### Mode 2: Demoï¼ˆæœ¬å–¶æ¥­æ®µéšï¼‰

**ç›®çš„**: å®Ÿéš›ã®AIã‚’è¦‹ã›ã‚‹ã€ã‚³ã‚¹ãƒˆç®¡ç†

**ç‰¹å¾´**:
- âœ… ç°¡æ˜“èªè¨¼ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰
- âœ… æœ¬ç‰©ã®AIï¼ˆOpenAI GPT-4oï¼‰
- âœ… ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆ50å›/æ—¥ï¼‰
- âœ… ã‚³ã‚¹ãƒˆç®¡ç†

**ç’°å¢ƒå¤‰æ•°**:
```env
DEMO_MODE=demo
DEMO_PASSWORD=your-secure-password-123
OPENAI_API_KEY=sk-xxx
RATE_LIMIT_PER_DAY=50
```

**å®Ÿè£…**:

```typescript
// middleware.ts
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
  // Demoãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã®ã¿èªè¨¼ãƒã‚§ãƒƒã‚¯
  if (process.env.DEMO_MODE === 'demo') {
    const password = request.cookies.get('demo_password')?.value;
    
    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ãªã„å ´åˆã¯èªè¨¼ãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    if (password !== process.env.DEMO_PASSWORD) {
      return NextResponse.redirect(new URL('/auth', request.url));
    }
  }
  
  return NextResponse.next();
}

export const config = {
  matcher: ['/((?!auth|api|_next/static|_next/image|favicon.ico).*)'],
};
```

```typescript
// lib/rate-limiter.ts
import { kv } from '@vercel/kv';

/**
 * ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯
 * @param identifier - IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯Cookie ID
 * @returns åˆ¶é™å†…ãªã‚‰trueã€è¶…éãªã‚‰false
 */
export async function checkRateLimit(identifier: string): Promise<boolean> {
  const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
  const key = `rate_limit:${identifier}:${today}`;
  
  // ã‚«ã‚¦ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
  const count = await kv.incr(key);
  
  // åˆå›ã®å ´åˆã¯æœ‰åŠ¹æœŸé™ã‚’24æ™‚é–“ã«è¨­å®š
  if (count === 1) {
    await kv.expire(key, 86400); // 24æ™‚é–“
  }
  
  const limit = parseInt(process.env.RATE_LIMIT_PER_DAY || '50', 10);
  return count <= limit;
}

/**
 * ç¾åœ¨ã®ä½¿ç”¨å›æ•°ã‚’å–å¾—
 */
export async function getRateLimitCount(identifier: string): Promise<number> {
  const today = new Date().toISOString().split('T')[0];
  const key = `rate_limit:${identifier}:${today}`;
  const count = await kv.get<number>(key);
  return count || 0;
}
```

```typescript
// lib/openai.ts
import OpenAI from 'openai';

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

/**
 * OpenAI APIã‚’ä½¿ç”¨ã—ã¦ãƒãƒ£ãƒƒãƒˆå¿œç­”ã‚’å–å¾—
 * @param message - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
 * @returns AI ã®å¿œç­”ãƒ†ã‚­ã‚¹ãƒˆ
 */
export async function getChatResponseFromOpenAI(
  message: string
): Promise<string> {
  try {
    const response = await openai.chat.completions.create({
      model: 'gpt-4o',
      messages: [
        {
          role: 'system',
          content: `ã‚ãªãŸã¯ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆæ‹…å½“AIã§ã™ã€‚
ä¸å¯§ã§è¦ªåˆ‡ãªå¯¾å¿œã‚’å¿ƒãŒã‘ã¦ãã ã•ã„ã€‚
ä»¥ä¸‹ã®æƒ…å ±ã‚’ã‚‚ã¨ã«å›ç­”ã—ã¦ãã ã•ã„ï¼š

ã€å–¶æ¥­æ™‚é–“ã€‘å¹³æ—¥9:00-18:00ã€åœŸæ—¥ç¥æ—¥ã¯ä¼‘æ¥­
ã€è¿”å“ãƒãƒªã‚·ãƒ¼ã€‘è³¼å…¥å¾Œ30æ—¥ä»¥å†…ã€æœªä½¿ç”¨å“ã®ã¿
ã€é€æ–™ã€‘å…¨å›½ä¸€å¾‹550å††ã€5,000å††ä»¥ä¸Šã§é€æ–™ç„¡æ–™
ã€æ”¯æ‰•ã„æ–¹æ³•ã€‘ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã€éŠ€è¡ŒæŒ¯è¾¼ã€ä»£å¼•ã`,
        },
        {
          role: 'user',
          content: message,
        },
      ],
      temperature: 0.7,
      max_tokens: 500,
    });

    return response.choices[0].message.content || '';
  } catch (error) {
    console.error('OpenAI API ã‚¨ãƒ©ãƒ¼:', error);
    throw new Error('AIã®å¿œç­”å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
}
```

**Vercelãƒ‡ãƒ—ãƒ­ã‚¤**:
- Productionç’°å¢ƒã«è¨­å®š
- URL: `https://ai-chatbot.vercel.app`
- ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

---

### Mode 3: Productionï¼ˆå—æ³¨å¾Œï¼‰

**ç›®çš„**: å®Ÿéš›ã®ç´å“ç‰©

**ç‰¹å¾´**:
- âœ… å®Œå…¨ãªèªè¨¼ï¼ˆNextAuth.jsç­‰ï¼‰
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
- âœ… ä¼šè©±å±¥æ­´ä¿å­˜

**ç’°å¢ƒå¤‰æ•°**:
```env
DEMO_MODE=production
AUTH_SECRET=xxx
DATABASE_URL=xxx
OPENAI_API_KEY=sk-xxx
```

**å®Ÿè£…**: æ¡ˆä»¶ã”ã¨ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

---

## APIä»•æ§˜

### POST /api/chat

ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã€AIå¿œç­”ã‚’å–å¾—

**Request**:
```typescript
{
  message: string;  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
}
```

**Response**:
```typescript
{
  response: string;  // AIã®å¿œç­”
  mode: 'mock' | 'demo' | 'production';  // ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰
  rateLimitRemaining?: number;  // æ®‹ã‚Šåˆ©ç”¨å¯èƒ½å›æ•°ï¼ˆdemoãƒ¢ãƒ¼ãƒ‰ã®ã¿ï¼‰
}
```

**ã‚¨ãƒ©ãƒ¼**:
```typescript
{
  error: string;  // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  code: 'RATE_LIMIT_EXCEEDED' | 'API_ERROR' | 'INVALID_REQUEST';
}
```

**å®Ÿè£…ä¾‹**:
```typescript
// app/api/chat/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { getChatResponse } from '@/lib/ai-client';
import { checkRateLimit, getRateLimitCount } from '@/lib/rate-limiter';

export async function POST(request: NextRequest) {
  try {
    const { message } = await request.json();

    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    if (!message || typeof message !== 'string') {
      return NextResponse.json(
        { error: 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå¿…è¦ã§ã™', code: 'INVALID_REQUEST' },
        { status: 400 }
      );
    }

    // Demoãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯
    if (process.env.DEMO_MODE === 'demo') {
      const ip = request.ip || 'unknown';
      const isAllowed = await checkRateLimit(ip);

      if (!isAllowed) {
        return NextResponse.json(
          {
            error: 'æœ¬æ—¥ã®åˆ©ç”¨ä¸Šé™ã«é”ã—ã¾ã—ãŸã€‚æ˜æ—¥å†åº¦ãŠè©¦ã—ãã ã•ã„',
            code: 'RATE_LIMIT_EXCEEDED',
          },
          { status: 429 }
        );
      }
    }

    // AIå¿œç­”ã‚’å–å¾—
    const response = await getChatResponse(message);

    // ãƒ¬ã‚¹ãƒãƒ³ã‚¹
    const result: any = {
      response,
      mode: process.env.DEMO_MODE || 'mock',
    };

    // Demoãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯æ®‹ã‚Šå›æ•°ã‚’è¿”ã™
    if (process.env.DEMO_MODE === 'demo') {
      const ip = request.ip || 'unknown';
      const count = await getRateLimitCount(ip);
      const limit = parseInt(process.env.RATE_LIMIT_PER_DAY || '50', 10);
      result.rateLimitRemaining = limit - count;
    }

    return NextResponse.json(result);
  } catch (error) {
    console.error('ãƒãƒ£ãƒƒãƒˆAPIã‚¨ãƒ©ãƒ¼:', error);
    return NextResponse.json(
      { error: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', code: 'API_ERROR' },
      { status: 500 }
    );
  }
}
```

---

### POST /api/auth

Demoãƒ¢ãƒ¼ãƒ‰ç”¨ã®èªè¨¼

**Request**:
```typescript
{
  password: string;  // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
}
```

**Response**:
```typescript
{
  success: boolean;
}
```

**å®Ÿè£…ä¾‹**:
```typescript
// app/api/auth/route.ts
import { NextRequest, NextResponse } from 'next/server';

export async function POST(request: NextRequest) {
  const { password } = await request.json();

  if (password === process.env.DEMO_PASSWORD) {
    const response = NextResponse.json({ success: true });
    
    // Cookieã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä¿å­˜ï¼ˆ7æ—¥é–“ï¼‰
    response.cookies.set('demo_password', password, {
      httpOnly: true,
      secure: process.env.NODE_ENV === 'production',
      maxAge: 60 * 60 * 24 * 7, // 7æ—¥
      path: '/',
    });

    return response;
  }

  return NextResponse.json({ success: false }, { status: 401 });
}
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### Vercel KVï¼ˆRedisï¼‰

#### ãƒ¬ãƒ¼ãƒˆåˆ¶é™
```
Key: rate_limit:{identifier}:{YYYY-MM-DD}
Value: number (ã‚«ã‚¦ãƒ³ãƒˆ)
TTL: 86400ç§’ï¼ˆ24æ™‚é–“ï¼‰

ä¾‹:
rate_limit:192.168.1.1:2025-12-12 = 25
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 1. API Keyç®¡ç†
- `.env.local` ã§ç®¡ç†ï¼ˆçµ¶å¯¾ã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ï¼‰
- Vercelã®ç’°å¢ƒå¤‰æ•°ã§è¨­å®š
- `.env.example` ã®ã¿ã‚³ãƒŸãƒƒãƒˆ

### 2. ãƒ¬ãƒ¼ãƒˆåˆ¶é™
- IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ™ãƒ¼ã‚¹
- 1æ—¥50å›ã¾ã§
- Vercel KV ã§ç®¡ç†

### 3. èªè¨¼
- Demoãƒ¢ãƒ¼ãƒ‰: ç°¡æ˜“ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆCookieï¼‰
- Productionãƒ¢ãƒ¼ãƒ‰: NextAuth.jsç­‰

### 4. XSSå¯¾ç­–
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚º
- React ã®è‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—

### 5. CSRFå¯¾ç­–
- Next.js ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ©Ÿèƒ½

---

## ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥

### Vercelè¨­å®š

#### Previewç’°å¢ƒï¼ˆMockãƒ¢ãƒ¼ãƒ‰ï¼‰
```env
DEMO_MODE=mock
```

- å…¨ãƒ–ãƒ©ãƒ³ãƒã®ãƒ—ãƒƒã‚·ãƒ¥ã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- URL: `https://ai-chatbot-git-{branch}.vercel.app`

#### Productionç’°å¢ƒï¼ˆDemoãƒ¢ãƒ¼ãƒ‰ï¼‰
```env
DEMO_MODE=demo
DEMO_PASSWORD=your-secure-password
OPENAI_API_KEY=sk-xxx
RATE_LIMIT_PER_DAY=50
```

- `main` ãƒ–ãƒ©ãƒ³ãƒã®ãƒãƒ¼ã‚¸ã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- URL: `https://ai-chatbot.vercel.app`

---

## é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º
```bash
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
make install

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆmockãƒ¢ãƒ¼ãƒ‰ï¼‰
make dev

# Demoãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆ
DEMO_MODE=demo DEMO_PASSWORD=test123 OPENAI_API_KEY=sk-xxx make dev
```

### ã‚³ãƒŸãƒƒãƒˆ
```bash
# pre-commitãƒ•ãƒƒã‚¯ãŒè‡ªå‹•å®Ÿè¡Œ
# - ESLint
# - Prettier
# - TypeScript type check

git add .
git commit -m "feat: ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’è¿½åŠ "
```

### ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
# è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆVercelï¼‰
git push origin main
```

---

## ä»Šå¾Œã®æ‹¡å¼µæ¡ˆ

1. **ä¼šè©±å±¥æ­´ã®ä¿å­˜**ï¼ˆVercel Postgresï¼‰
2. **ãƒ¦ãƒ¼ã‚¶ãƒ¼æº€è¶³åº¦è©•ä¾¡**ï¼ˆğŸ‘/ğŸ‘ï¼‰
3. **ç®¡ç†ç”»é¢**ï¼ˆFAQç·¨é›†ã€çµ±è¨ˆè¡¨ç¤ºï¼‰
4. **å¤šè¨€èªå¯¾å¿œ**ï¼ˆi18nï¼‰
5. **éŸ³å£°å…¥åŠ›å¯¾å¿œ**ï¼ˆWeb Speech APIï¼‰
6. **ç”»åƒèªè­˜**ï¼ˆGPT-4o Visionï¼‰
7. **Slack/LINEé€£æº**

---

## å‚è€ƒè³‡æ–™

- [Next.js Documentation](https://nextjs.org/docs)
- [OpenAI API Documentation](https://platform.openai.com/docs)
- [Vercel Documentation](https://vercel.com/docs)
- [shadcn/ui](https://ui.shadcn.com/)
